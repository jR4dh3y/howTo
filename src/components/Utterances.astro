---
interface Props {
	repo: string;
}

const { repo } = Astro.props;
---

<div id="utterances-container" class="mt-16 pt-8 border-t border-[var(--border)]">
	<h3 class="font-display text-xl mb-6 text-[var(--fg)]">Comments</h3>
	<div id="utterances-wrapper"></div>
</div>

<script define:vars={{ repo }}>
	function loadUtterances() {
		const wrapper = document.getElementById("utterances-wrapper");
		if (!wrapper) return;

		const isDark = document.documentElement.classList.contains("dark");
		const theme = isDark ? "github-dark" : "github-light";

		const existingScript = wrapper.querySelector("script.utterances");
		if (existingScript) existingScript.remove();

		const existingFrame = wrapper.querySelector(".utterances");
		if (existingFrame) existingFrame.remove();

		const script = document.createElement("script");
		script.src = "https://utteranc.es/client.js";
		script.setAttribute("repo", repo);
		script.setAttribute("issue-term", "pathname");
		script.setAttribute("theme", theme);
		script.setAttribute("crossorigin", "anonymous");
		script.async = true;
		script.classList.add("utterances");
		wrapper.appendChild(script);
	}

	document.addEventListener("DOMContentLoaded", loadUtterances);

	const toggle = document.getElementById("theme-toggle");
	toggle?.addEventListener("click", () => {
		setTimeout(loadUtterances, 100);
	});
</script>

<style>
	.font-display {
		font-family: var(--font-display);
	}

	#utterances-wrapper :global(.utterances) {
		max-width: 100%;
	}

	#utterances-wrapper :global(.utterances-frame) {
		width: 100%;
	}
</style>
