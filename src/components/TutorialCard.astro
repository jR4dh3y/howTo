---
import { extractVideoId, getThumbnailUrl } from '../utils/youtube';

interface Props {
	title: string;
	description: string;
	date: Date;
	slug: string;
	tags: string[];
	youtubeUrl?: string;
}

const { title, description, date, slug, tags, youtubeUrl } = Astro.props;

const formattedDate = date.toLocaleDateString("en-US", {
	year: "numeric",
	month: "short",
	day: "numeric",
});

const videoId = youtubeUrl ? extractVideoId(youtubeUrl) : null;
const thumbnailUrl = videoId ? getThumbnailUrl(videoId) : null;
---

<article 
	class="group flex flex-col sm:flex-row gap-4 p-4 rounded-xl border border-[var(--border)] bg-[var(--surface)] transition-all duration-300 hover:border-[var(--highlight)] hover:shadow-lg hover:shadow-[var(--accent)]/10 hover:-translate-y-0.5"
	data-tags={tags.join(',')}
>
	{/* Thumbnail Image - only show if youtubeUrl is provided */}
	{thumbnailUrl && (
		<a href={`/${slug}`} class="block sm:w-48 md:w-56 flex-shrink-0">
			<div class="aspect-video rounded-lg overflow-hidden bg-[var(--bg)]">
				<img 
					src={thumbnailUrl} 
					alt={`Thumbnail for ${title}`}
					class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
					loading="lazy"
				/>
			</div>
		</a>
	)}

	<!-- Content -->
	<div class="flex-1 flex flex-col min-w-0">
		<a href={`/${slug}`} class="block flex-1">
			<h2 class="text-lg sm:text-xl mb-2 text-[var(--accent)] group-hover:text-[var(--highlight)] transition-colors duration-200" style="font-family: var(--font-display);">
				{title}
			</h2>
			<p class="text-sm text-[var(--muted)] leading-relaxed line-clamp-2">
				{description}
			</p>
		</a>

		<!-- Bottom row: Date and Tags -->
		<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mt-3 pt-3 border-t border-[var(--border)]">
			<!-- Date -->
			<time class="text-xs uppercase tracking-widest text-[var(--muted)] font-medium">
				{formattedDate}
			</time>

			<!-- Tags -->
			{tags.length > 0 && (
				<div class="flex flex-wrap gap-1.5">
					{tags.map((tag) => (
						<button
							class="tag-filter-btn px-2 py-0.5 text-xs rounded-full border border-[var(--border)] bg-[var(--bg)] text-[var(--muted)] transition-all duration-200 hover:border-[var(--highlight)] hover:text-[var(--highlight)]"
							data-tag={tag}
							onclick="event.preventDefault(); event.stopPropagation();"
						>
							{tag}
						</button>
					))}
				</div>
			)}
		</div>
	</div>
</article>
